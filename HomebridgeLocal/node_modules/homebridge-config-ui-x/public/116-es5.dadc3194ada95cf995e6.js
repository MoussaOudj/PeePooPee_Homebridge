!function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}(self.webpackChunkui=self.webpackChunkui||[]).push([[116],{5116:function(e,i,n){"use strict";n.r(i),n.d(i,{DockerModule:function(){return E}});var s=n(38583),a=n(3679),o=n(71271),c=n(95935),u=n(36592),l=n(40294),p=n(63423),h=n(64762),f=n(37716),d=n(92503),g=n(79274),m=n(58605),v=n(64959),w=n(49344);function _(t,e){1&t&&f._UZ(0,"i",13)}function k(t,e){if(1&t){var r=f.EpF();f.TgZ(0,"ngx-monaco-editor",14),f.NdJ("onInit",function(t){return f.CHM(r),f.oxw().onEditorInit(t)})("keydown.control.s",function(t){f.CHM(r);var e=f.oxw();return t.preventDefault(),e.onSave()})("keydown.meta.s",function(t){f.CHM(r);var e=f.oxw();return t.preventDefault(),e.onSave()}),f.qZA()}if(2&t){var i=f.oxw();f.Q6J("options",i.editorOptions)("model",i.monacoEditorModel)}}function b(t,e){if(1&t){var r=f.EpF();f.TgZ(0,"textarea",15),f.NdJ("ngModelChange",function(t){return f.CHM(r),f.oxw().startupScript=t}),f._uU(1,"  "),f.qZA()}if(2&t){var i=f.oxw();f.Q6J("ngModel",i.startupScript)}}var x=function(){var e=function(){function e(r,i,n,s,a,o,c){t(this,e),this.$settings=r,this.$api=i,this.$md=n,this.$monacoEditor=s,this.$toastr=a,this.translate=o,this.$route=c,this.isMobile=!1,this.options={printMargin:!1},this.editorOptions={language:"shell",theme:this.$settings.theme.startsWith("dark-mode")?"vs-dark":"vs-light",automaticLayout:!0},this.isMobile=this.$md.detect.mobile()}return r(e,[{key:"ngOnInit",value:function(){var t=this;this.visualViewPortEventCallback=function(){return t.visualViewPortChanged()},this.lastHeight=window.innerHeight,window.visualViewport&&!this.isMobile&&(window.visualViewport.addEventListener("resize",this.visualViewPortEventCallback,!0),this.$md.disableTouchMove()),this.$route.data.subscribe(function(e){t.startupScript=e.startupScript.script}),this.monacoEditorModel={value:"",language:"shell"}}},{key:"onEditorInit",value:function(t){this.monacoEditor=t,this.monacoEditor.getModel().setValue(this.startupScript)}},{key:"onSave",value:function(){return(0,h.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.saveInProgress){t.next=19;break}if(this.saveInProgress=!0,t.t0=this.isMobile,t.t0){t.next=7;break}return t.next=6,this.monacoEditor.getAction("editor.action.formatDocument").run();case 6:this.startupScript=this.monacoEditor.getModel().getValue();case 7:if("#!/bin/sh"===this.startupScript.split("\n")[0].trim()){t.next=9;break}return t.abrupt("return",(this.$toastr.error(this.translate.instant("platform.docker.startup_script.toast_script_must_use_hashbang"),this.translate.instant("platform.docker.startup_script.toast_title_script_error")),this.startupScript="#!/bin/sh\n\n"+this.startupScript,this.isMobile||this.monacoEditor.getModel().setValue(this.startupScript),void(this.saveInProgress=!1)));case 9:return t.prev=9,t.next=12,this.$api.put("/platform-tools/docker/startup-script",{script:this.startupScript}).toPromise();case 12:this.$toastr.success(this.translate.instant("platform.docker.startup_script.toast_restart_required"),this.translate.instant("platform.docker.startup_script.toast_title_script_saved")),t.next=18;break;case 15:t.prev=15,t.t1=t.catch(9),this.$toastr.error(t.t1.message,this.translate.instant("toast.title_error"));case 18:this.saveInProgress=!1;case 19:case"end":return t.stop()}},t,this,[[9,15]])}))}},{key:"visualViewPortChanged",value:function(){this.lastHeight<window.visualViewport.height&&document.activeElement.blur(),window.visualViewport.height<window.innerHeight?(this.$md.enableTouchMove(),this.lastHeight=window.visualViewport.height):window.visualViewport.height===window.innerHeight&&(this.$md.disableTouchMove(),this.lastHeight=window.visualViewport.height)}},{key:"ngOnDestroy",value:function(){window.visualViewport&&(window.visualViewport.removeEventListener("resize",this.visualViewPortEventCallback,!0),this.$md.enableTouchMove()),this.monacoEditor&&this.monacoEditor.dispose()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(f.Y36(d.g),f.Y36(g.s),f.Y36(m.L),f.Y36(v.L),f.Y36(w._W),f.Y36(c.sK),f.Y36(p.gz))},e.\u0275cmp=f.Xpm({type:e,selectors:[["app-startup-script"]],decls:18,vars:8,consts:[[1,"flex-column","d-flex","align-items-stretch","h-100"],[1,"row"],[1,"col-sm-8","d-none","d-sm-block"],[1,"primary-text","m-0"],[1,"d-none","d-md-inline"],[1,"col-sm-4","text-right"],[1,"btn","btn-primary","waves-effect","m-0",3,"disabled","click"],["class","fas fa-spinner fa-pulse",4,"ngIf"],[1,"row","mt-3"],[1,"col-md-12"],["role","alert",1,"alert","alert-warning",3,"translate"],["class","flex-grow-1 h-100 w-100 mb-3 mt-3",3,"options","model","onInit","keydown.control.s","keydown.meta.s",4,"ngIf"],["wrap","off","class","hb-plain-text-editor align-self-end h-100 w-100 mb-3 mt-3","autocomplete","off","autocorrect","off","autocapitalize","off","spellcheck","false",3,"ngModel","ngModelChange",4,"ngIf"],[1,"fas","fa-spinner","fa-pulse"],[1,"flex-grow-1","h-100","w-100","mb-3","mt-3",3,"options","model","onInit","keydown.control.s","keydown.meta.s"],["wrap","off","autocomplete","off","autocorrect","off","autocapitalize","off","spellcheck","false",1,"hb-plain-text-editor","align-self-end","h-100","w-100","mb-3","mt-3",3,"ngModel","ngModelChange"]],template:function(t,e){1&t&&(f.TgZ(0,"div",0),f.TgZ(1,"div",1),f.TgZ(2,"div",2),f.TgZ(3,"h3",3),f.TgZ(4,"span",4),f._uU(5,"Docker Container"),f.qZA(),f._uU(6," startup.sh"),f.qZA(),f.qZA(),f.TgZ(7,"div",5),f.TgZ(8,"button",6),f.NdJ("click",function(){return e.onSave()}),f._uU(9),f.ALo(10,"translate"),f.YNc(11,_,1,0,"i",7),f.qZA(),f.qZA(),f.qZA(),f.TgZ(12,"div",8),f.TgZ(13,"div",9),f.TgZ(14,"div",10),f._uU(15," This script will be executed each time the docker container starts. You can use this to install any extra packages your plugins may need such as ffmpeg or libpcap-dev. "),f.qZA(),f.qZA(),f.qZA(),f.YNc(16,k,1,2,"ngx-monaco-editor",11),f.YNc(17,b,2,1,"textarea",12),f.qZA()),2&t&&(f.xp6(8),f.Q6J("disabled",e.saveInProgress),f.xp6(1),f.hij(" ",f.lcZ(10,6,"form.button_save")," "),f.xp6(2),f.Q6J("ngIf",e.saveInProgress),f.xp6(3),f.Q6J("translate","platform.docker.startup_script.message_script_help"),f.xp6(2),f.Q6J("ngIf",!e.isMobile),f.xp6(1),f.Q6J("ngIf",e.isMobile))},directives:[s.O5,c.Pi,u.PG,a.Fj,a.JJ,a.On],pipes:[c.X$],styles:[""]}),e}(),Z=n(45417),y=n(48703);function T(t,e){1&t&&f._UZ(0,"app-spinner")}function $(t,e){1&t&&(f.TgZ(0,"p",8),f._uU(1," Please wait, this page will automatically redirect when the Homebridge is back online."),f.qZA()),2&t&&f.Q6J("translate","restart.message_please_wait_while_server_restarts")}function M(t,e){if(1&t&&(f.TgZ(0,"p",9),f._uU(1),f.qZA()),2&t){var r=f.oxw();f.xp6(1),f.Oqu(r.error)}}function I(t,e){1&t&&(f.TgZ(0,"div"),f.TgZ(1,"p",8),f._uU(2," Server restart is taking a long time. You may need to bring up the Docker container manually."),f.qZA(),f.TgZ(3,"p",10),f.ALo(4,"translate"),f._uU(5,"Make sure you're running the Docker container with "),f.TgZ(6,"strong"),f._uU(7,"--restart=always"),f.qZA(),f.qZA(),f.qZA()),2&t&&(f.xp6(1),f.Q6J("translate","platform.docker.restart_container.message_server_taking_long_time_to_restart"),f.xp6(2),f.Q6J("innerHTML",f.lcZ(4,2,"platform.docker.restart_container.message_run_with_restart_always"),f.oJD))}var A,q=function(){var e=function(){function e(r,i,n,s,a,o){t(this,e),this.$api=r,this.$ws=i,this.$settings=n,this.$toastr=s,this.translate=a,this.$router=o,this.io=this.$ws.connectToNamespace("status"),this.resp={},this.timeout=!1,this.error=!1}return r(e,[{key:"ngOnInit",value:function(){var t=this;this.io.connected.subscribe(function(){t.io.socket.emit("monitor-server-status"),t.$settings.getAppSettings().catch()}),this.$api.put("/platform-tools/docker/restart-container",{}).subscribe(function(e){t.resp=e,t.checkIfServerUp()},function(e){var r=t.translate.instant("restart.toast_server_restart_error");t.error=r+".",t.$toastr.error("".concat(r,": ").concat(e.message),t.translate.instant("toast.title_error"))})}},{key:"checkIfServerUp",value:function(){var t=this;this.checkDelay=setTimeout(function(){t.io.socket.on("homebridge-status",function(e){"up"!==e.status&&"pending"!==e.status||(t.$toastr.success(t.translate.instant("platform.docker.restart_container.toast_container_restarted"),t.translate.instant("toast.title_success")),t.$router.navigate(["/"]))})},1e4),this.checkTimeout=setTimeout(function(){t.$toastr.warning(t.translate.instant("restart.toast_sever_restart_timeout"),t.translate.instant("toast.title_warning"),{timeOut:1e4}),t.timeout=!0},6e4)}},{key:"ngOnDestroy",value:function(){this.io.end(),clearTimeout(this.checkDelay),clearTimeout(this.checkTimeout)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(f.Y36(g.s),f.Y36(Z.r),f.Y36(d.g),f.Y36(w._W),f.Y36(c.sK),f.Y36(p.F0))},e.\u0275cmp=f.Xpm({type:e,selectors:[["app-container-restart"]],decls:10,vars:5,consts:[[4,"ngIf"],[1,"row"],[1,"col-md-12","text-center"],[1,"primary-text"],[1,"fab","fa-docker"],[1,"primary-text",3,"translate"],["class","grey-text",3,"translate",4,"ngIf"],["class","grey-text",4,"ngIf"],[1,"grey-text",3,"translate"],[1,"grey-text"],[1,"primary-text",3,"innerHTML"]],template:function(t,e){1&t&&(f.YNc(0,T,1,0,"app-spinner",0),f.TgZ(1,"div",1),f.TgZ(2,"div",2),f.TgZ(3,"h1",3),f._UZ(4,"i",4),f.qZA(),f.TgZ(5,"h3",5),f._uU(6,"Restarting Docker Container"),f.qZA(),f.YNc(7,$,2,1,"p",6),f.YNc(8,M,2,1,"p",7),f.YNc(9,I,8,4,"div",0),f.qZA(),f.qZA()),2&t&&(f.Q6J("ngIf",!e.error),f.xp6(5),f.Q6J("translate","platform.docker.restart_container.title_restarting"),f.xp6(2),f.Q6J("ngIf",!e.timeout&&!e.error),f.xp6(1),f.Q6J("ngIf",e.error),f.xp6(1),f.Q6J("ngIf",e.timeout))},directives:[s.O5,c.Pi,y.O],pipes:[c.X$],encapsulation:2}),e}(),J=function(){var e=function(){function e(r,i,n){t(this,e),this.$api=r,this.$toastr=i,this.$router=n}return r(e,[{key:"resolve",value:function(t,e){var r=this;return this.$api.get("/platform-tools/docker/startup-script").toPromise().catch(function(t){r.$toastr.error(t.message,"Failed to Load Startup Script"),r.$router.navigate(["/"])})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(f.LFG(g.s),f.LFG(w._W),f.LFG(p.F0))},e.\u0275prov=f.Yz7({token:e,factory:e.\u0275fac}),e}(),S=[{path:"",redirectTo:"/",pathMatch:"full"},{path:"startup-script",component:x,resolve:{startupScript:J}},{path:"restart-container",component:q}],Y=function(){var e=function e(){t(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=f.oAB({type:e}),e.\u0275inj=f.cJS({imports:[[p.Bz.forChild(S)],p.Bz]}),e}(),E=((A=function e(){t(this,e)}).\u0275fac=function(t){return new(t||A)},A.\u0275mod=f.oAB({type:A}),A.\u0275inj=f.cJS({providers:[J],imports:[[s.ez,a.u5,a.UX,u.nm,o.IJ,c.aw.forChild(),l.I,Y]]}),A)}}])}();